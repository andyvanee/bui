<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../assets/style.css?t=615badd5">
    <link rel="stylesheet" href="../style.css?t=0174a9d9">
    <link rel="stylesheet" href="../bui.css?t=d5fa3047">
    <script src="../assets/script.js?t=42463e55"></script>
    <script src="../bui.js?t=fe627057"></script>
    <title>Helpers - Blackstone UI</title>
    <meta name="viewport" content="width=device-width">
  </head>
  <body class="-menu-visible">
    <div class="doc-layout">
      <div class="toggle menu-toggle js-menu-toggle"></div>
      <div class="menu toc-menu">
        <li class="menu-item -level-0 -parent">
          <ul class="submenu">
            <li class="menu-item -level-1"><a class="link title  link-index" href="../index.html">Blackstone UI</a>
            </li>
            <li class="menu-item -level-1 -parent"><span class="title">Components</span>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title  link-elements" href="../elements/index.html">Elements</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-icons" href="../icons.html">Icons</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presentersdialog" href="../presenters/dialog/index.html">Dialog</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presentersform" href="../presenters/form/index.html">Form Control</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presenterslist" href="../presenters/list/index.html">List</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presentersmenu" href="../presenters/menu/index.html">Menu</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presenterspanel" href="../presenters/panel/index.html">Panel</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presentersnotif" href="../presenters/notif/index.html">Notif</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presenterspopover" href="../presenters/popover/index.html">Popover</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presenterstabs" href="../presenters/tabs/index.html">Tabs</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presentersselection" href="../presenters/selection/index.html">Selection</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presentersmentions" href="../presenters/mentions/index.html">Mentions</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-presenterscal" href="../presenters/cal/index.html">Calendar</a>
                </li>
              </ul>
            </li>
            <li class="menu-item -level-1 -parent"><span class="title">Extras</span>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title  link-colors" href="../colors.html">Colors</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-util" href="../util/index.html">Util</a>
                </li>
                <li class="menu-item -level-2 -parent"><a class="link title -active link-helpers" href="../helpers/index.html">Helpers</a>
                  <ul class="headings heading-list">
                    <li class="heading-item -depth-2"><a class="hlink link-litelement" href="#litelement">LitElement</a>
                      <ul class="heading-list -depth-2">
                        <li class="heading-item -depth-3"><a class="hlink link-listeners" href="#listeners">Listeners</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-events" href="#events">Events</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-get" href="#get">Get</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-model-coll" href="#model-coll">Model / Coll</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-shared" href="#shared">Shared</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-event-target-model" href="#event-target-model">Event Target Model</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-subviews" href="#subviews">Subviews</a>
                        </li>
                      </ul>
                    </li>
                    <li class="heading-item -depth-2"><a class="hlink link-backbone.js" href="#backbone.js">Backbone.js</a>
                      <ul class="heading-list -depth-2">
                        <li class="heading-item -depth-3"><a class="hlink link-singleton" href="#singleton">Singleton</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-promises" href="#promises">Promises</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-attribute-types" href="#attribute-types">Attribute Types</a>
                        </li>
                        <li class="heading-item -depth-3"><a class="hlink link-relations" href="#relations">Relations</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                  <ul class="submenu">
                    <li class="menu-item -level-3"><a class="link title  link-helpersbackbonerelations" href="../helpers/backbone/relations/index.html">Backbone.js Relations</a>
                    </li>
                  </ul>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-router" href="../router/index.html">Router</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-models" href="../models/index.html">Models (WIP)</a>
                </li>
              </ul>
            </li>
            <li class="menu-item -level-1 -parent"><span class="title">Server</span>
              <ul class="submenu">
                <li class="menu-item -level-2"><a class="link title  link-server" href="../server/index.html">Overview</a>
                </li>
                <li class="menu-item -level-2"><a class="link title  link-serverrealtime" href="../server/realtime/index.html">Realtime</a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </div>
      <div class="body page-helpers">
        <div class="header-nav">
          <div class="right">
          </div>
        </div>
        <div class="markdown-body"><h1 id="helpers">Helpers</h1>
<p>Helpers extend existing tools and libraries with added functionality. Typically helpers only need to be imported once and may be done on the root JS file.</p>
<hr>
<h2 id="litelement">LitElement</h2>
<p>Extend LitElement to fit our needs. I like doing this so that we dont have to create unnecessary subclasses</p>
<pre><code class="lang-js"><span class="pl-c">// include all lit-element helpers</span>
<span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element&apos;</span>
</code></pre>
<h3 id="listeners">Listeners</h3>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/listeners&apos;</span>
</code></pre>
<p>Adds support for listening to Backbone Model/Collection/ChildCollection
events and responding. Most events should just be calling <code>update</code> which
will rerender the view.</p>
<pre><code class="lang-javascript"><span class="pl-k">static</span> <span class="pl-k">get</span> listeners(){ <span class="pl-k">return</span> {
    <span class="pl-s">&apos;model&apos;</span>: {
        <span class="pl-s">&apos;change reset&apos;</span>: <span class="pl-s">&apos;update&apos;</span>
    },
    <span class="pl-s">&apos;child-collection&apos;</span>: {
        <span class="pl-s">&apos;reset&apos;</span>: <span class="pl-s">&apos;update&apos;</span>
    }
}}

<span class="pl-c">// ^ equivalent to:</span>
<span class="pl-k">this</span>.model.on(<span class="pl-s">&apos;change reset&apos;</span>, <span class="pl-k">this</span>.update.bind(<span class="pl-k">this</span>))
<span class="pl-k">this</span>.model.get(<span class="pl-s">&apos;child-collection&apos;</span>).on(<span class="pl-s">&apos;reset&apos;</span>, <span class="pl-k">this</span>.update.bind(<span class="pl-k">this</span>))
</code></pre>
<h3 id="events">Events</h3>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/events&apos;</span>
</code></pre>
<p>To simplify event dispatching from inside the shadow dom, an <code>emitEvent</code>
method has been added to lit-element</p>
<pre><code class="lang-js"><span class="pl-k">this</span>.emitEvent(eventName, detail)
<span class="pl-k">this</span>.emitEvent(<span class="pl-s">&apos;element-event&apos;</span>, {<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>})
</code></pre>
<p>The emitted event with have <code>bubbles: true</code> and <code>composed: true</code> so that the even
will bubble up and out of the shadow dom</p>
<h3 id="get">Get</h3>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/get&apos;</span>
</code></pre>
<p>Shortcut to <code>this.model.get()</code> that also supports <code>defaultValue</code></p>
<pre><code class="lang-js"><span class="pl-k">this</span>.get(<span class="pl-s">&apos;some_key&apos;</span>, <span class="pl-s">&apos;default Value&apos;</span>)
</code></pre>
<h3 id="model-coll">Model / Coll</h3>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/model&apos;</span>
<span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/coll&apos;</span>
</code></pre>
<p>A common pattern is to pass a model object to the custom element. This extension
will unbind and rebind listeners (if using that extension; see above) and then
call <code>onModelChange</code> to let you hook into the update and do something (like fetch data)</p>
<pre><code class="lang-js">onModelChange(model){
    <span class="pl-k">if</span>( model )
        model.fetch()
}
</code></pre>
<h3 id="shared">Shared</h3>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/shared&apos;</span>
</code></pre>
<p>Define a custom element with a &#x201C;shared&#x201D; singleton feature. Useful for when a view will be used in multiple places but only needs to be intialized once and then reused.</p>
<pre><code class="lang-js"><span class="pl-k">let</span> MyElement = customElements.defineShared(<span class="pl-s">&apos;my-element&apos;</span>, <span class="hljs-class"><span class="pl-k">class</span> <span class="pl-k">extends</span> <span class="pl-ent">LitElement</span></span>{
    open(){
        log(<span class="pl-s">&apos;open this view&apos;</span>)
    }
})

MyElement.shared.open()

<span class="pl-c1">console</span>.log(MyElement.shared == MyElement.shared) <span class="pl-c">// true</span>
<span class="pl-c1">console</span>.log(MyElement.shared == <span class="pl-k">new</span> MyElement() ) <span class="pl-c">// false</span>
</code></pre>
<h3 id="event-target-model">Event Target Model</h3>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/event-target-model&apos;</span>
</code></pre>
<p>A pattern at Blackstone when using lit-html is to render
a collection of items as a set of controls. Buttons and actions
are taken that need access to the model which has been set at the top
level of the html item. This extension makes it easer to access
the model and top parent target</p>
<pre><code class="lang-js">html`<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="pl-s">&quot;item&quot;</span> <span class="hljs-attr">.model</span>=</span></span><span class="hljs-subst">${m}</span><span class="xml"><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>stuff here<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">b-btn</span> @<span class="hljs-attr">click</span>=</span></span><span class="hljs-subst">${<span class="pl-k">this</span>.takeAction}</span><span class="xml"><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b-btn</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`</span>

takeAction(e){
    <span class="pl-k">let</span> model = e.model
    <span class="pl-k">let</span> target = e.modelTarget <span class="pl-c">// =&gt; `.item`</span>

    <span class="pl-c">// same as</span>
    target = e.currentTarget.parentElement.parentElement
    model = target.model
}
</code></pre>
<h3 id="subviews">Subviews</h3>
<blockquote>
<p>Considering DEPRECATION</p>
</blockquote>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;bui/helpers/lit-element/sv&apos;</span>
</code></pre>
<p>Sometimes a linked subview needs to be created and we&#x2019;d like to keep
and reuse it rather than recreate it each time (for example, a view
that pops over an element to edit)</p>
<pre><code class="lang-javascript"><span class="pl-c">// syntax</span>
<span class="pl-k">this</span>.sv(viewName, elementName)

<span class="pl-c">// the view will be created if it doesn&apos;t exist</span>
<span class="pl-k">this</span>.sv(<span class="pl-s">&apos;edit&apos;</span>, <span class="pl-s">&apos;my-edit-view&apos;</span>)
</code></pre>
<hr>
<h2 id="backbone.js">Backbone.js</h2>
<p>If you want to use Backbone.js for managing data (models/collections) there are some helpers
to improve the workflow.</p>
<h3 id="singleton">Singleton</h3>
<p>Export a a Collection as a singleton</p>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;helpers/backbone/singleton&apos;</span>
<span class="pl-k">import</span> {Collection, singleton} <span class="pl-k">from</span> <span class="pl-s">&apos;backbone&apos;</span>

<span class="hljs-class"><span class="pl-k">class</span> <span class="pl-ent">Coll</span> <span class="pl-k">extends</span> <span class="pl-ent">Collection</span></span>{}

<span class="pl-k">export</span> <span class="pl-k">default</span> singleton(Coll)
</code></pre>
<h3 id="promises">Promises</h3>
<p>Crud methods in promise form</p>
<pre><code class="lang-js"><span class="pl-k">import</span> <span class="pl-s">&apos;helpers/backbone/promises&apos;</span>

<span class="pl-k">await</span> model.fetchSync()
<span class="pl-k">await</span> model.saveSync()
<span class="pl-k">await</span> model.destroySync()

<span class="pl-k">await</span> collection.fetchSync()
<span class="pl-k">await</span> collection.createSync()
</code></pre>
<h3 id="attribute-types">Attribute Types</h3>
<p>Make sure <code>.get()</code> attributes returns data in the expected type (e.g. a number or date object rather than a string)</p>
<pre><code class="lang-js"><span class="pl-c">// Supported Types</span>
<span class="pl-k">const</span> ModelAttrTypes = {
	<span class="pl-s">&apos;string&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> <span class="pl-c1">String</span>(val) },
	<span class="pl-s">&apos;json&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> <span class="pl-k">typeof</span> val == <span class="pl-s">&apos;string&apos;</span> ? <span class="pl-c1">JSON</span>.parse(val) : val },
	<span class="pl-s">&apos;bool&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> !!val },
	<span class="pl-s">&apos;boolish&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> !!val &amp;&amp; val !== <span class="pl-s">&apos;0&apos;</span> &amp;&amp; val !== <span class="hljs-number">0</span>},
	<span class="pl-s">&apos;int&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> val ? <span class="pl-c1">parseInt</span>(val) : <span class="hljs-number">0</span> },
	<span class="pl-s">&apos;float&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> val ? <span class="pl-c1">parseFloat</span>(val) : <span class="hljs-number">0</span> },
	<span class="pl-s">&apos;num&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> val ? <span class="pl-c1">parseFloat</span>(val) : <span class="hljs-number">0</span> },
	<span class="pl-s">&apos;date&apos;</span>: <span class="hljs-function"><span class="pl-k">function</span>(<span class="hljs-params">val</span>)</span>{ <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Date</span>(val) }
}
</code></pre>
<pre><code class="lang-js"><span class="pl-c">// How to use</span>
<span class="pl-k">import</span> <span class="pl-s">&apos;helpers/backbone/attr-types&apos;</span>

<span class="hljs-class"><span class="pl-k">class</span> <span class="pl-ent">MyModel</span> <span class="pl-k">extends</span> <span class="pl-ent">Backbone</span>.<span class="pl-ent">Model</span> </span>{

    <span class="pl-k">get</span> attrTypes(){<span class="pl-k">return</span> {
        <span class="hljs-attr">is_active</span>: <span class="pl-s">&apos;bool&apos;</span>,
        <span class="hljs-attr">ts_created</span>: <span class="pl-s">&apos;date&apos;</span>,
    }}
}

<span class="pl-k">let</span> myModel = <span class="pl-k">new</span> MyModel({
    <span class="hljs-attr">is_active</span>:<span class="pl-s">&apos;1&apos;</span>,
    <span class="hljs-attr">ts_created</span>: <span class="pl-s">&apos;2019-10-24 10:30:16&apos;</span>
})

myModel.get(<span class="pl-s">&apos;is_active&apos;</span>) <span class="pl-c">// true</span>
myModel.get(<span class="pl-s">&apos;ts_created&apos;</span>) <span class="pl-c">// Date()</span>
</code></pre>
<blockquote>
<p>Attributes will be cached and only re-evaluated to their type after changed</p>
</blockquote>
<h4 id="registering-your-own-attribute-type">Registering your own attribute type</h4>
<pre><code class="lang-js"><span class="pl-k">import</span> dayjs <span class="pl-k">from</span> <span class="pl-s">&apos;dayjs&apos;</span>

Backbone.registerModelAttrType(<span class="pl-s">&apos;date&apos;</span>, val=&gt;{
    <span class="pl-k">return</span> dayjs(val)
})

<span class="pl-c">//....</span>
myModel.get(<span class="pl-s">&apos;ts_created&apos;</span>).format(<span class="pl-s">&apos;l&apos;</span>)
</code></pre>
<h3 id="relations">Relations</h3>
<p>Any non-trivial app will require models contain nested children. This helper aids in the implementation
of related models and collections. Children classes are only created when accessed and will pull data
from the parent model&#x2019;s attributes or a specificed lookup collection.</p>
<p><a href="backbone/relations/index.html">Read more on Relations</a></p>

        </div>
        <div class="footer-nav">
          <div class="left"><a href="../util/index.html"><span class="title">Util</span></a></div>
          <div class="right"><a href="../helpers/backbone/relations/index.html"><span class="label">Next: </span><span class="title">Backbone.js Relations</span></a></div>
        </div>
      </div>
    </div>
  </body>
</html>